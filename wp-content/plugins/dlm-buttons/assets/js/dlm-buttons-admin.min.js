jQuery(function(a){var b;a(".dlm-buttons-wrap")&&(b=new DLM_Buttons_Preview(a(".dlm-buttons-wrap:first"))),a.each(a(".dlm-buttons-color-picker"),function(c,d){a(d).wpColorPicker({change:function(a,c){b.restartPreviewTimer()}})})});var DLM_Buttons_Preview=function(a){this.container=a,this.config_wrap=null,this.iframe=null,this.previewTimer=null,this.templateName=null,this.isSaving=!1,this.setup=function(){var a=this;this.config_wrap=jQuery(this.container).find(".dlm-buttons-config:first"),this.iframe=jQuery(this.container).find("#dlm-buttons-preview-frame:first"),this.templateName=jQuery(this.config_wrap).data("template_name"),jQuery("#dlm-buttons-save").click(function(){a.save()}),this.setupChangeListener(),this.loadPreview()},this.setup()};DLM_Buttons_Preview.prototype.getConfigElements=function(){return jQuery(this.config_wrap).find(".dlm-buttons-config-field")},DLM_Buttons_Preview.prototype.setupChangeListener=function(){var a=this;jQuery.each(a.getConfigElements(),function(b,c){jQuery(c).change(function(){a.restartPreviewTimer()})})},DLM_Buttons_Preview.prototype.restartPreviewTimer=function(){var a=this;clearTimeout(this.previewTimer),this.previewTimer=setTimeout(function(){a.loadPreview()},750)},DLM_Buttons_Preview.prototype.loadPreview=function(){var a=dlm_buttons_strings.button_preview_url_base;jQuery.each(this.getConfigElements(),function(b,c){var d=jQuery(c).val();jQuery(c).hasClass("dlm-buttons-color-picker")&&(d=d.replace("#","")),jQuery(c).is(":checkbox")&&(d=0,jQuery(c).prop("checked")&&(d=1)),a+="&"+jQuery(c).attr("name")+"="+d}),a=encodeURI(a),this.iframe.attr("src",a)},DLM_Buttons_Preview.prototype.startSaving=function(){this.isSaving=!0,jQuery(".dlm-buttons-successIcon").remove(),jQuery("#dlm-buttons-save").parent().append(jQuery("<img>").attr("src",dlm_buttons_strings.img_loader).addClass("dlm-buttons-loader"))},DLM_Buttons_Preview.prototype.endSaving=function(a){jQuery(".dlm-buttons-loader").remove();var b=jQuery("<div>").addClass("dlm-buttons-successIcon").html(dlm_buttons_strings.lbl_button_saved);jQuery("#dlm-buttons-save").parent().append(b),b.delay(800).fadeOut("slow",function(){b.remove()}),this.isSaving=!1},DLM_Buttons_Preview.prototype.save=function(){if(!this.isSaving){var a=this;this.startSaving();var b={};jQuery.each(this.getConfigElements(),function(a,c){var d=jQuery(c).val();jQuery(c).hasClass("dlm-buttons-color-picker")&&(d=d.replace("#","")),jQuery(c).is(":checkbox")&&(d=0,jQuery(c).prop("checked")&&(d=1)),b[jQuery(c).attr("name")]=d});var c={action:"dlm_buttons_save_template",template_name:this.templateName,security:dlm_buttons_strings.nonce_save_template,options:b};jQuery.post(ajaxurl,c,function(b){b.success,a.endSaving(b.success)})}};